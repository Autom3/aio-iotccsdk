# TensorFlow Mobilenet SSD Models

1. COCO-trained models: ssd_mobilenet_v2_coco
    * Download and expand the pretrained [ssd_mobilenet_v2_coco model](http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v2_coco_2018_03_29.tar.gz).
    * Copy the extracted frozen_inference_graph.pb to "sample-solution-1\MachineLearning\models\ssd_mobilenet_v2_coco" folder
    * Overwrite "current_config.py" by "ssd_mobilenet_v2_coco.py" under "sample-solution-1\MachineLearning\scripts\model_configs" folder
    * Execute "01-convert-model-containerize.py" under "sample-solution-1\MachineLearning\scripts" folder to convert model and generate deployment.json for "ssd_mobilenet_v2_coco" model

2. Sample to retrain Mobilenet V1 SSD Model by a custom dataset "poker3"
    * "poker3" under this folder is a custom dataset.
      * "image*.tfrecord files" under "poker3\data\train" and "poker3\data\test" are generated by [Microsoft VOTT v1.7.2 Tagging Tool](https://github.com/Microsoft/VoTT). 
      * "ssd_mobilenet_v1_coco.config" under "poker3\config" folder is modified from https://github.com/tensorflow/models/blob/r1.5/research/object_detection/samples/configs/ssd_mobilenet_v1_coco.config
      * "object_detection_ssdv1_retrain.ipynb" under "poker3" folder is modified from https://github.com/tensorflow/models/blob/r1.5/research/object_detection/object_detection_tutorial.ipynb and used to evaluate the retrained "frozen_inference_graph.pb".
    * Steps to retrain "poker3" dataset under Windows 10
      * Create a new Windows 10 v1809 Azure VM or a clean installed Windows 10.
      * Install [Anaconda Python 3.6.5](https://repo.anaconda.com/archive/Anaconda3-5.2.0-Windows-x86_64.exe) and add Anaconda path to system "Path" environment variable.
      * Execute the following commands under Anaconda Command Prompt:
        * pip install msgpack
        * pip install tensorflow==1.5.0
        * conda install -c anaconda protobuf
      * Download or clone TensorFlow models [r1.5 branch](https://github.com/tensorflow/models/tree/r1.5).
      * Copy the full "models" foder to a subfolder, for example: c:\tf.
      * Add the following system environment variable:
        * PYTHONPATH=C:\tf\models;C:\tf\models\research;C:\tf\models\research\slim
      * Execute the following command under "C:\tf\models\research" folder:
        * protoc --python_out=. .\object_detection\protos\anchor_generator.proto .\object_detection\protos\argmax_matcher.proto .\object_detection\protos\bipartite_matcher.proto .\object_detection\protos\box_coder.proto .\object_detection\protos\box_predictor.proto .\object_detection\protos\eval.proto .\object_detection\protos\faster_rcnn.proto .\object_detection\protos\faster_rcnn_box_coder.proto .\object_detection\protos\grid_anchor_generator.proto .\object_detection\protos\hyperparams.proto .\object_detection\protos\image_resizer.proto .\object_detection\protos\input_reader.proto .\object_detection\protos\losses.proto .\object_detection\protos\matcher.proto .\object_detection\protos\mean_stddev_box_coder.proto .\object_detection\protos\model.proto .\object_detection\protos\optimizer.proto .\object_detection\protos\pipeline.proto .\object_detection\protos\post_processing.proto .\object_detection\protos\preprocessor.proto .\object_detection\protos\region_similarity_calculator.proto .\object_detection\protos\square_box
        * python setup.py build
        * python setup.py install
      * Download and expand [ssd_mobilenet_v1_coco model](http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v1_coco_2017_11_17.tar.gz).
      * Copy the extracted "ssd_mobilenet_v1_coco_2017_11_17" folder to "C:\tf\models\research\objection_detection" folder
      * Copy "poker3" folder to "C:\tf\models\research\objection_detection" folder
      * Execute the following command under "C:\tf\models\research\objection_detection" folder to retrain a new model by poker3 dataset:
        * python train.py --logtostderr --train_dir=./poker3/ckpt/ --pipeline_config_path=./poker3/config/ssd_mobilenet_v1_coco.config
      * Execute the following command under "C:\tf\models\research\objection_detection" folder to generate a new "frozen_inference_graph.pb" under "poker3\frozen_graph" folder (change "model.ckpt-10000" to the model.ckpt-xxx file generated under "poker3\ckpt" folder ):
        * python export_inference_graph.py --input_type image_tensor --pipeline_config_path ./poker3/config/ssd_mobilenet_v1_coco.config --trained_checkpoint_prefix ./poker3/ckpt/model.ckpt-10000 --output_directory ./poker3/frozen_graph
      * Overwrite "current_config.py" by "ssd_mobilenet_v1_retrain_poker3.py" under "sample-solution-1\MachineLearning\scripts\model_configs" folder
      * Execute "01-convert-model-containerize.py" under "sample-solution-1\MachineLearning\scripts" folder to convert model and generate deployment.json for "ssd_mobilenet_v1_retrain_poker3" model



    
